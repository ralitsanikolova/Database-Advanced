@using Models;
@page "/tictactoe"

<div class="contentAlign">
	<div class="float-container">
		<div class="float-child">
			<h3>@status</h3>
		</div>
		<div class="float-child">
			<button class="button" @onclick="Reset">Reset Game</button>
		</div>
	</div>

	<br />
	<div class="board">
		@for (int i = 0; i < 9; i++)
		{
			int squareNumber = i;
			<Square @key=squareNumber
					value=values[squareNumber]
					ClickHandler="@(() => HandleClick(squareNumber))" />
		}
	</div>
	<br />
	<h4>Current Score: O @countO || @countX X</h4>
</div>

@code {
	private bool xIsFirst;

	protected string status;
	protected int countX;
	protected int countO;

	protected char[] values = new char[9];

	public void Reset()
	{
		this.PopulateBoard();
	}

	protected override void OnInitialized()
	{
		this.PopulateBoard();
	}

	protected void PopulateBoard()
	{
		values = new char[9]
		{
			' ', ' ', ' ',
			' ', ' ', ' ',
			' ', ' ', ' '
		};

		xIsFirst = true;

		this.CalculateStatus();
	}

	protected void HandleClick(int i)
	{
		if (values[i] != ' ')
		{
			return;
		}

		bool isGameFiniched = Game.CalculateGameStatus(values) != GameState.stillPlaying;
		if (isGameFiniched)
		{
			return;
		}

		bool xToPlay = xIsFirst;

		values[i] = xToPlay ? 'X' : 'O';
		xIsFirst = !xToPlay;

		this.CalculateStatus();
	}

	private void CalculateStatus()
	{
		var gameStatus = Game.CalculateGameStatus(values);

		switch (gameStatus)
		{
			case GameState.xWins:
				this.status = "Winner is X";
				this.countX += 1;
				break;
			case GameState.oWins:
				this.status = "Winner is  O";
				this.countO += 1;
				break;
			case GameState.draw:
				this.status = "Draw !";
				break;
			case GameState.stillPlaying:
				char nextPlayer = xIsFirst ? 'X' : 'O';
				this.status = $"Next player: {nextPlayer}";
				break;
			default:
				break;

		}
	}
}

<style scoped>
	.board {
		display: grid;
		grid-template-columns: auto auto auto;
		background-color: #c9a0dc;
		padding: 10px;
		width: 300px;
		height: 300px;
		border-radius: 10%;
		top: 50%;
		left: 50%;
	}

	.button {
		background-color: white;
		color: black;
		border: 2px solid #C8A2C8
	}

	.button:hover {
		background-color: #C8A2C8;
		color: white;
	}

	.contentAlign {
		max-width: 500px;
		margin: auto;
	}

	.float-child {
		width: 41%;
		float: left;
		padding: 20px;
	}
</style>
